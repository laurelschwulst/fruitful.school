function ditherImage(t,a,e){let o=t.getImageData(0,0,a,e);for(let r=0;r<e;r++)for(let d=0;d<a;d++){let l=(r*a+d)*4,n=o.data[l],$=o.data[l+1],f=o.data[l+2],i=findClosestColor(n),_=findClosestColor($),c=findClosestColor(f);o.data[l]=i,o.data[l+1]=_,o.data[l+2]=c;let g=n-i,s=$-_,m=f-c;distributeError(o,d,r,a,e,g,s,m)}t.putImageData(o,0,0)}function findClosestColor(t){return t<128?0:255}document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("canvas"),a=t.getContext("2d"),e=document.getElementById("smallCanvas"),o=e.getContext("2d"),r=new Image;r.src="imgs/c_image.jpg",r.onload=function(){let t=document.createElement("canvas"),e=t.getContext("2d");t.width=440,t.height=142,e.drawImage(r,0,0,440,142),ditherImage(e,440,142);let d=e.getImageData(0,0,440,142).data,l=0,n=setInterval(()=>{for(let t=0;t<50&&l<15e4;t++){let e=Math.floor(440*Math.random()),r=Math.floor(142*Math.random()),$=(440*r+e)*4,f=d[$],i=d[$+1],_=d[$+2],c=d[$+3]/255;if(a.fillStyle=`rgba(${f},${i},${_},${c})`,a.fillRect(e,r,1,1),e<35&&r<35&&Math.random()>.4&&(o.fillStyle=`rgba(${f},${i},${_},${c})`,o.fillRect(e,r,1,1)),++l>=15e4){clearInterval(n);break}}},1)}});const rF=Math.floor(10*Math.random())+10;function distributeError(t,a,e,o,r,d,l,n){for(let $ of[{dx:1,dy:0,factor:7/rF},{dx:-1,dy:1,factor:3/rF},{dx:0,dy:1,factor:5/rF},{dx:1,dy:1,factor:1/rF},]){let f=a+$.dx,i=e+$.dy;if(f>=0&&f<o&&i>=0&&i<r){let _=(i*o+f)*4;t.data[_]+=d*$.factor,t.data[_+1]+=l*$.factor,t.data[_+2]+=n*$.factor}}}
